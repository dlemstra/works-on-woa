---
import { CollectionEntry, getCollection } from "astro:content";
import type { PaginateFunction } from "astro";
import CategoryLayout from "../../layouts/CategoryLayout.astro";

export async function getStaticPaths({
  paginate,
}: {
  paginate: PaginateFunction;
}) {
  const categories = [
    ...(await getCollection("categories")).map((category) => category.id),
    "all",
  ];
  const projects = await getCollection("projects");
  // return paginate(projects, { pageSize: 25 });

  return categories.map((c) => {
    const pageData = projects.filter((p) => {
      const cats = p.data.categories ?? [];
      return (
        c === "all" ||
        cats
          .map((cat) => cat.id)
          .includes(c as CollectionEntry<"categories">["id"])
      );
    });
    return paginate(pageData, {
      params: { category: c.toLowerCase() },
      pageSize: 24,
    });
  });
}
const { category } = Astro.params;
const { page } = Astro.props;
---

<CategoryLayout page={page} category={category} />
